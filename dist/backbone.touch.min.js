/*!
 * backbone.touch - v0.3.0
 * Copyright 2012, Raymond Julin (@nervetattoo)
 * backbone.touch.js may be freely distributed under the MIT license.
 */(function(t){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],t):t(_,Backbone)})(function(t,e){"use strict";var n=function(e,n){return e&&e[n]?t.isFunction(e[n])?e[n]():e[n]:null},i=/^(\S+)\s*(.*)$/;return t.extend(e.View.prototype,{_touching:!1,touchPrevents:!0,touchThreshold:10,isTouch:"ontouchstart"in document&&!("callPhantom"in window),delegateEvents:function(e){if(e||(e=n(this,"events"))){this.undelegateEvents();var o=".delegateEvents"+this.cid;t(e).each(function(n,h){if(t.isFunction(n)||(n=this[e[h]]),!n)throw Error('Method "'+e[h]+'" does not exist');var c=h.match(i),s=c[1],u=c[2],a=t.bind(this._touchHandler,this);n=t.bind(n,this),this.isTouch&&"click"===s?(this.$el.on("touchstart"+o,u,a),this.$el.on("touchend"+o,u,{method:n},a)):(s+=o,""===u?this.$el.bind(s,n):this.$el.on(s,u,n))},this)}},_touchHandler:function(t){if("changedTouches"in t.originalEvent){var e=t.originalEvent.changedTouches[0],n=e.clientX,i=e.clientY;switch(t.type){case"touchstart":this._touching=[n,i];break;case"touchend":var o=this._touching[0],h=this._touching[1],c=this.touchThreshold;if(o+c>n&&n>o-c&&h+c>i&&i>h-c){if(this._touching=!1,this.touchPrevents){var s=t.currentTarget.tagName;("BUTTON"===s||"A"===s)&&(t.preventDefault(),t.stopPropagation())}t.data.method(t)}}}}}),e});