/*!
 * backbone.touch.js v0.1
 * Copyright 2012, Raymond Julin (@nervetattoo)
 * backbone.touch.js may be freely distributed under the MIT license.
 */
(function(a){"use strict",typeof define=="function"&&define.amd?define(["underscore","backbone"],a):a(_,Backbone)})(function(a,b){"use strict";var c=function(b,c){return!b||!b[c]?null:a.isFunction(b[c])?b[c]():b[c]},d=/^(\S+)\s*(.*)$/;return a.extend(b.View.prototype,{_touching:!1,touchPrevents:!0,isTouch:"ontouchstart"in document&&!("callPhantom"in window),delegateEvents:function(b){if(!b&&!(b=c(this,"events")))return;this.undelegateEvents();var e=".delegateEvents"+this.cid;a(b).each(function(c,f){a.isFunction(c)||(c=this[b[f]]);if(!c)throw new Error('Method "'+b[f]+'" does not exist');var g=f.match(d),h=g[1],i=g[2],j=a.bind(this._touchHandler,this);c=a.bind(c,this),this.isTouch&&h==="click"?(this.$el.on("touchstart"+e,i,j),this.$el.on("touchend"+e,i,{method:c},j)):(h+=e,i===""?this.$el.bind(h,c):this.$el.on(h,i,c))},this)},_touchHandler:function(a){if(!("changedTouches"in a.originalEvent))return;var b=a.originalEvent.changedTouches[0],c=b.clientX,d=b.clientY;switch(a.type){case"touchstart":this._touching=[c,d];break;case"touchend":var e=this._touching[0],f=this._touching[1],g=10;if(c<e+g&&c>e-g&&d<f+g&&d>f-g){this._touching=!1;if(this.touchPrevents){var h=a.currentTarget.tagName;if(h==="BUTTON"||h==="A")a.preventDefault(),a.stopPropagation()}a.data.method(a)}}}}),b})